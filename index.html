<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE ORANGE SIGNAL - Bitcoin News Aggregator</title>
    <meta name="description" content="Stay updated with the latest Bitcoin news and podcasts with THE ORANGE SIGNAL.">
    <meta name="keywords" content="Bitcoin, News, Aggregator, BTC, Podcasts">
    <meta name="author" content="BXL909">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Inter:wght@400;600&display=swap');
        
        :root {
            --bitcoin-orange: #E8833A;   
            --dark-orange: #B35F1D;      
            --dark-bg: #1A1B1E;          
            --darker-bg: #13141A;        
            --card-bg: rgba(26, 27, 32, 0.8); 
            --dropdown-bg: rgba(26, 27, 32, 1); 
            --text-primary: #FFFFFF;      
            --text-secondary: #A8A9AF;    
            --title-color: #A8A9AF;       
            --favicon-background: #2D2E33; 
            --accent-glow: rgba(232, 131, 58, 0.15);
            --link-color: #93a9c0;        
            --hover-color: #E8833A;       
            --card-hover-transform: scale(1.01) translateY(-2px);
            --card-transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        :root[data-theme="light"] {
            --bitcoin-orange: #E8833A;  
            --dark-orange: #B35F1D;     
            --dark-bg: #F5F6F8;         
            --darker-bg: #FFFFFF;       
            --card-bg: #FFFFFF;         
            --dropdown-bg: #FFFFFF;     
            --text-primary: #1A1B1E;    
            --text-secondary: #5A6670;  
            --title-color: #5A6670;     
            --favicon-background: #E8E9ED;
            --accent-glow: rgba(232, 131, 58, 0.12); 
            --link-color: #3A4B5B;        
            --hover-color: #E8833A;       
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background: var(--darker-bg);
            color: var(--text-primary);
            position: relative;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        h1, .article-source, .share-btn {
            font-family: 'JetBrains Mono', monospace;
        }

        h1 {
            color: var(--title-color);
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(247, 147, 26, 0.5);
            background: linear-gradient(45deg, var(--text-primary), var(--bitcoin-orange));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            position: relative;
        }

        .article {
            background-color: var(--card-bg);
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 8px;
            border: 1px solid var(--favicon-background);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: var(--card-transition), background-color 0.3s, box-shadow 0.3s, transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            text-align: left;
            transform-origin: center;
            z-index: 1;
        }

        .article:hover {
            transform: var(--card-hover-transform);
        }

        .article h2 {
            margin-top: 0;
            color: var(--text-primary);
            font-size: 1.1rem;
            line-height: 1.3;
            display: flex;
            align-items: flex-start; 
            gap: 10px;
        }

        .article h2 .source-logo {
            flex-shrink: 0;
            height: 1.2rem;
            width: 1.2rem;
            border-radius: 4px;
            padding: 2px;
            object-fit: contain;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            margin-top: 0.15em; 
        }

        .article h2 a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.2s;
            background: linear-gradient(
                to right,
                var(--bitcoin-orange) 0%,
                var(--bitcoin-orange) 100%
            );
            background-size: 0 2px;
            background-position: 0 100%;
            background-repeat: no-repeat;
            transition: background-size 0.3s ease, color 0.2s ease;
        }

        .article h2 a:hover {
            color: var(--hover-color);
            text-shadow: none;
            background-size: 100% 2px;
        }

        .article-meta {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;  
            gap: 15px;
            row-gap: 10px;    
        }

        .article-meta-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;  
            margin-right: auto;
        }

        .article-meta-right {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;  
        }

        .reading-time {
            color: var(--text-secondary);
            font-size: 0.85em;
        }

        .article-source {
            background-color: rgba(200, 200, 200, 0.1);
            color: var(--text-secondary);
            border: 1px solid var(--favicon-background);
            padding: 0px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;  
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .source-logo {
            width: 16px;
            height: 16px;
            object-fit: contain;
            vertical-align: middle;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); 
            border-radius: 4px;
            padding: 2px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .source-logo:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .article-date {
            color: var(--text-secondary);
            font-size: 0.85em;
        }

        .article-description {
            color: var(--text-secondary);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            max-height: 6.4em;
            text-align: left;
            font-size: 0.95em;
        }

        .article-description img {
            width: 120px;
            height: 80px;
            object-fit: cover;
            object-position: left top;
            float: left;
            margin-right: 15px;
            margin-bottom: 5px;
            border-radius: 4px;
            border: 1px solid var(--favicon-background);
            display: block;
        }

        @media (max-width: 500px) {
            .article-description {
                display: block;
                overflow: hidden;
                text-overflow: ellipsis;
                max-height: 6.4em;
            }

            .article-description img {
                width: 100px;
                height: 67px;
                shape-outside: margin-box;
                margin-right: 12px;
                margin-bottom: 4px;
            }
        }

        #loading {
            text-align: center;
            padding: 20px;
            color: var(--bitcoin-orange);
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        :root[data-theme="light"] #particleCanvas {
            opacity: 0.3;
        }

        .article-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .share-btn {
            background-color: rgba(200, 200, 200, 0.15); 
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
            margin: 0;
        }

        .share-btn:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
            transform: translateY(-1px);
        }

        .share-btn svg {
            fill: var(--text-secondary);
        }

        .share-btn:hover svg {
            fill: var(--hover-color);
        }

        .article-description a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        .article-description a:hover {
            color: var(--hover-color);
            text-shadow: none;
        }

        .website-source {
            background-color: rgba(200, 200, 200, 0.1);
            border: 1px solid var(--favicon-background);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .website-source:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
            transform: translateY(-1px);
        }

        .layout-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 4px;
            background: var(--card-bg);
            padding: 4px 6px;
            border-radius: 20px;
            border: 1px solid var(--favicon-background);
            z-index: 99999;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 20px;
            height: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(200, 200, 200, 0.15); 
            transition: .4s;
            border-radius: 24px;
            border: 1px solid var(--favicon-background);
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: rgba(232, 131, 58, 0.25);  
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 6px;
            width: 6px;
            left: 1px;
            bottom: 1px;
            background-color: var(--link-color); 
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(10px);
            background-color: var(--bitcoin-orange);
        }

        .toggle-label {
            color: var(--text-secondary);
            font-size: 0.6em;
            font-family: 'JetBrains Mono', monospace;
        }

        #articles.grid-layout {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            padding: 0 0px;
        }

        #articles.grid-layout .article {
            margin-bottom: 0;
        }

        .theme-toggle {
            position: fixed;
            top: 10px;
            right: 75px;
            display: flex;
            align-items: center;
            gap: 4px;
            background: var(--card-bg);
            padding: 4px 6px;
            border-radius: 20px;
            border: 1px solid var(--favicon-background);
            z-index: 99999;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .article {
            transition: var(--card-transition), background-color 0.3s, box-shadow 0.3s, transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .load-more-btn {
            display: block;
            margin: 30px auto;
            padding: 12px 24px;
            background-color: var(--card-bg);
            color: var(--bitcoin-orange);
            border: 1px solid var(--favicon-background);
            border-radius: 20px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .load-more-btn:hover {
            background-color: var(--accent-glow);
            transform: translateY(-2px);
        }

        .skeleton {
            background: linear-gradient(90deg, 
                var(--card-bg) 25%, 
                var(--accent-glow) 50%, 
                var(--card-bg) 75%
            );
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .search-container {
            position: relative;
            z-index: 2000;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
            padding: 0 0px;
            flex-wrap: wrap;
            justify-content: center; 
        }

        .search-container input {
            flex: 0 1 auto;
            width: 160px; 
            max-width: 200px;
            min-width: 200px;
            order: 4; 
        }

        .source-dropdown {
            order: 1; 
        }

        #refreshBtn {
            order: 2; 
        }

        #bookmarksToggle {
            order: 3; 
        }

        .search-container input,
        .search-container select,
        .search-container .share-btn {
            background: var(--card-bg);
            border: 1px solid var(--favicon-background);
            border-radius: 20px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            backdrop-filter: blur(5px);
            height: 32px;
            box-sizing: border-box; 
        }

        .search-container select,
        .search-container .share-btn {
            padding: 8px 16px;
        }

        .search-container input {
            padding: 8px 16px; 
            flex: 1;
            min-width: 16px;
            width: 100%;
        }

        .search-container .button-group {
            display: flex;
            gap: 10px;
            flex-shrink: 0; 
        }

        .search-container input:focus,
        .search-container select:focus {
            outline: none;
            border-color: var(--bitcoin-orange);
            box-shadow: 0 0 0 2px var(--accent-glow);
        }

        @media (max-width: 600px) {
            .search-container {
                gap: 8px; 
            }
            
            .search-container input {
                flex: 1 1 100%;
                width: 100%; 
                min-width: 0;
                order: 3; 
            }
        }

        @media (max-width: 500px) {
            .banner-container {
                padding: 20px 10px 30px; 
            }
        }

        .bookmark-btn.active {
            color: var(--bitcoin-orange);
        }

        .bookmark-btn.active svg {
            fill: var(--bitcoin-orange);
        }

        .article-description p {
            margin: 0;
            padding: 0;
        }

        .article-description p:first-child {
            margin-top: 0;
        }

        .article-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .article-modal.active {
            display: flex;
        }

        .article-frame-container {
            position: relative;
            width: 90%;
            height: 90%;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid var(--favicon-background);
        }

        .article-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: var(--card-bg);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--card-bg);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
            z-index: 1;
        }

        .close-modal:hover {
            color: var(--hover-color);
            transform: scale(1.1);
        }

        body.modal-open {
            overflow: hidden;
        }

        .article-preview {
            position: fixed;
            width: 300px;
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--favicon-background);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 1000;
            pointer-events: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .article-preview.visible {
            opacity: 1;
            visibility: visible;
        }

        .article::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            border-radius: 9px; 
            background: linear-gradient(45deg, transparent, var(--bitcoin-orange) 50%, transparent);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }

        .article:hover::before {
            opacity: 0.1;
        }

        @media (max-width: 500px) {
            .article-meta {
                gap: 10px;
            }
            
            .article-meta-left,
            .article-meta-right {
                gap: 10px;
            }
            
            .article-source {
                max-width: 150px; 
            }
        }

        .banner-container {
            position: relative;
            text-align: center;
            padding: 46px 20px 25px;
            margin: -20px -20px 0;

        }

        .banner-content {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .title-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 40px;
            height: 40px;
            position: relative;
            animation: rotate 20s linear infinite;
            flex-shrink: 0; 
            aspect-ratio: 1/1; 
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain; 
            filter: drop-shadow(0 0 8px var(--accent-glow));
        }

        h1 {
            margin: 0;
            font-size: 2.4rem;
            background: linear-gradient(
                45deg,
                var(--text-primary) 10%,
                var(--bitcoin-orange) 30%,
                var(--text-primary) 50%
            );
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 8s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes shine {
            to { background-position: 200% center; }
        }

        .share-btn.active {
            color: var(--bitcoin-orange);
            background: var(--accent-glow);
        }
        
        .share-btn.active svg {
            fill: var(--bitcoin-orange);
        }

        .search-container select {
            display: none;
        }

        .source-dropdown {
            position: relative;
            z-index: 2000;
        }

        .source-dropdown-btn {
            background-color: rgba(200, 200, 200, 0.15); 
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 4px 10px;
            height: 32px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
            margin: 0;
        }

        .source-dropdown-btn:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
            transform: translateY(-1px);
        }

        .source-dropdown-btn svg {
            fill: none;
            stroke: var(--text-secondary);
        }

        .source-dropdown-btn:hover svg {
            stroke: var(--hover-color);
        }

        .source-dropdown-content {

            position: absolute;
            top: 100%;
            left: 0;
            background: var(--dropdown-bg);
            border: 1px solid var(--favicon-background);
            border-radius: 8px;
            padding: 8px;
            min-width: 230px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 2000; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .source-dropdown.active .source-dropdown-content {
            display: block;
        }

        .source-option {
            display: flex;
            align-items: flex-start;  
            gap: 8px;
            padding: 6px 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .source-option input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            min-width: 16px !important;
            min-height: 16px !important;
            border: 1px solid var(--favicon-background);
            border-radius: 4px;
            background: var(--card-bg);
            margin: 0;
            cursor: pointer;
            position: relative;
            flex: 0 0 16px; 
            transition: all 0.2s ease;
            box-sizing: border-box; 
        }

        .source-option input[type="checkbox"]:checked {
            background: var(--accent-glow);
            border-color: var(--bitcoin-orange);
        }

        .source-option input[type="checkbox"]:checked::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background-color: var(--bitcoin-orange);
            border-radius: 2px;
        }

        .source-option input[type="checkbox"]:hover {
            border-color: var(--bitcoin-orange);
            background: var(--accent-glow);
        }

        .source-option input[type="checkbox"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-glow);
        }

        .source-option label {
            font-size: 0.85em;
            flex: 1;  
            text-align: left;
            margin-left: 4px;  
        }

        .source-option:hover {
            background: var(--accent-glow);
        }

        .source-option input[type="checkbox"] {
            margin: 0;
        }

        .source-option img {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }

        .selected-count {
            background-color: rgba(200, 200, 200, 0.1);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.85em;
        }

        .background-bitcoin {
            position: fixed;
            top: 200px;
            left: 200px;
            transform: translate(-50%, -50%);
            width: 75vw; 
            height: auto;
            aspect-ratio: 1/1; 
            z-index: -1;
            opacity: 0.08; 
            animation: slowRotate 60s linear infinite;
            pointer-events: none;
        }

        :root[data-theme="light"] .background-bitcoin {
            opacity: 0.08; 
        }

        @keyframes slowRotate {
            from {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        @media (min-width: 2000px) {
            .background-bitcoin {
                width: 1500px; 
            }
        }

        #articles.compact-mode .article-meta
        {
            margin-top: 16px;
        }


        #articles.compact-mode .article h2 {
            margin: 0; 
            line-height: 24px; 
        }

        #articles.compact-mode .article.expanded {
            height: auto;
            padding: 15px;
        }

        #articles.compact-mode .article-meta,
        #articles.compact-mode .article-description,
        #articles.compact-mode .article-actions {
            opacity: 0;
            visibility: hidden;
            position: absolute;
            pointer-events: none;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #articles.compact-mode .article.expanded .article-meta,
        #articles.compact-mode .article.expanded .article-description,
        #articles.compact-mode .article.expanded .article-actions {
            opacity: 1;
            visibility: visible;
            position: static;
            pointer-events: auto; 
        }

        .expand-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            margin: 0;
            border-radius: 15px 0 8px 0;
            z-index: 2;
            
            display: none;
            
            background-color: rgba(200, 200, 200, 0.1);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 0px 6px;
            font-size: 0.85em;
            cursor: pointer;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
        }

        #articles.compact-mode .expand-btn {
            display: flex;
        }

        .expand-btn:hover {
            transform: translateY(-2px) translateX(-2px);
            color: var(--hover-color);
            background: var(--accent-glow);
        }

        .expand-btn svg {
            fill: var(--text-secondary);
        }

        .expand-btn:hover svg {
            fill: var(--hover-color);
        }

        .compact-toggle {
            position: fixed;
            top: 10px;
            right: 146px;
            display: flex;
            align-items: center;
            gap: 4px;
            background: var(--card-bg);
            padding: 4px 6px;
            border-radius: 20px;
            border: 1px solid var(--favicon-background);
            z-index: 99999;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); 
        }

        .source-divider {
            height: 1px;
            background: var(--favicon-background);
            margin: 8px 0;
        }

        .source-dropdown-btn svg {
            transition: transform 0.2s ease;
        }

        .source-dropdown.active .source-dropdown-btn svg {
            transform: rotate(180deg);
        }

        .source-logo, .source-option img {
            width: 16px;
            height: 16px;
            object-fit: contain;
            vertical-align: middle;
            background-color: rgba(255, 255, 255, 0.1); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); 
            border-radius: 4px;
            padding: 2px;
        }

        :root[data-theme="light"] .source-logo,
        :root[data-theme="light"] .source-option img {
            background-color: rgba(255, 255, 255, 0.8); 
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #bookmarksToggle {
            background-color: rgba(200, 200, 200, 0.15);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
            margin: 0;
        }

        #bookmarksToggle:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
            transform: translateY(-1px);
        }

        #bookmarksToggle svg {
            fill: var(--text-secondary);
        }

        #bookmarksToggle:hover svg {
            fill: var(--hover-color);
        }

        #bookmarksToggle.active {
            color: var(--bitcoin-orange);
            background: var(--accent-glow);
        }

        #bookmarksToggle.active svg {
            fill: var(--bitcoin-orange);
        }

        .source-dropdown.active .source-dropdown-btn {
            color: var(--bitcoin-orange);
            background: var(--accent-glow);
        }

        .source-dropdown.active .source-dropdown-btn svg {
            stroke: var(--bitcoin-orange);
        }

        .selected-count {
            background-color: rgba(200, 200, 200, 0.1);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.85em;
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .article.loading {
            background: linear-gradient(
                90deg,
                var(--card-bg) 0%,
                rgba(255, 255, 255, 0.08) 50%,
                var(--card-bg) 100%
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear;
        }

        * {
            transition: background-color 0.3s ease,
                        color 0.3s ease,
                        border-color 0.3s ease,
                        box-shadow 0.3s ease;
        }

        .add-feed-button {
            background-color: rgba(200, 200, 200, 0.15);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
            margin: 0;
            width: 100%;
        }

        .add-feed-button:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
            transform: translateY(-1px);
        }

        .add-feed-button svg {
            fill: none;
            stroke: var(--text-secondary);
        }

        .add-feed-button:hover svg {
            stroke: var(--hover-color);
        }

        .custom-feed-form {
            padding: 12px;
            border-top: 1px solid var(--favicon-background);
            display: none;
        }

        .custom-feed-form.active {
            display: block;
        }

        .custom-feed-form input {
            width: 100%;
            padding: 6px;
            margin-bottom: 8px;
            background: var(--card-bg);
            border: 1px solid var(--favicon-background);
            border-radius: 4px;
            color: var(--text-primary);
        }

        .custom-feed-form button {
            background: var(--card-bg);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
        }

        .custom-feed-form button:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
        }

        .source-option .remove-feed {
            margin-left: auto;
            opacity: 0;
            transition: opacity 0.2s;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .source-option:hover .remove-feed {
            opacity: 1;
        }

        .remove-feed:hover {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        .custom-feed-label {
            font-style: italic;
            opacity: 0.8;
        }

        .share-btn .label,
        .bookmark-btn .label {
            transition: opacity 0.2s, visibility 0.2s;
        }

        #articles.grid-layout .share-btn .label,
        #articles.grid-layout .bookmark-btn .label {
            display: none;
        }

        #articles.grid-layout .share-btn,
        #articles.grid-layout .bookmark-btn {
            padding: 4px;
            width: 24px;
            height: 24px;
            justify-content: center;
        }

        .share-btn .label,
        #bookmarksToggle .label {
            transition: opacity 0.2s, visibility 0.2s;
        }

        #articles.grid-layout .share-btn .label,
        #articles.grid-layout #bookmarksToggle .label {
            display: none;
        }

        #articles.grid-layout .share-btn,
        #articles.grid-layout #bookmarksToggle {
            padding: 4px;
            width: 24px;
            height: 24px;
            justify-content: center;
        }

        .share-btn svg,
        #bookmarksToggle svg {
            display: block;
        }

        #articles.grid-layout .article-source.website-source {
            width: 20px;
            padding: 0px;
        }

        #articles.grid-layout .article-source.website-source span:not(.source-logo) {
            display: none;
        }

        #articles.grid-layout .article-source {
            width: 20px;
            padding: 0px;
        }

        #articles.grid-layout .article-source span:not(.source-logo) {
            display: none;
        }

        .bitcoin-stats {
            background-color: var(--card-bg);
            padding: 5px 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            border: 1px solid var(--favicon-background);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            transition: var(--card-transition);
        }

        .stat-item {
            flex: 1;
            min-width: 200px;
            text-align: center;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 5px;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            color: var(--dark-orange);
            font-size: 1.1em;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        @media (max-width: 768px) {
            .bitcoin-stats {
                padding: 12px;
                gap: 15px;
            }

            .stat-item {
                min-width: 140px;
            }

            .stat-value {
                font-size: 1.1em;
            }
        }

        body::-webkit-scrollbar {
            width: 8px;
        }

        body::-webkit-scrollbar-track {
            background: var(--darker-bg);
        }

        body::-webkit-scrollbar-thumb {
            background: var(--favicon-background);
            border-radius: 4px;
            opacity: 0.5;
        }

        body::-webkit-scrollbar-thumb:hover {
            background: var(--dark-orange);
        }

        .spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #refreshBtn {
            background-color: rgba(200, 200, 200, 0.15);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
            margin: 0;
        }

        #refreshBtn:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
            transform: translateY(-1px);
        }

        #refreshBtn svg {
            fill: none;
            stroke: var(--text-secondary);
        }

        #refreshBtn:hover svg {
            stroke: var(--hover-color);
        }

       
        .help-button {
            position: fixed;
            top: 10px;
            right: 229px;
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--card-bg);
            padding: 4px 6px;
            border-radius: 20px;
            border: 1px solid var(--favicon-background);
            z-index: 99999;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            color: var(--text-secondary);
            font-size: 0.6em;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
        }

        .help-button:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
            transform: translateY(-2px);
        }

        .help-button svg {
            fill: none;
            stroke: currentColor;
            width: 14px;
            height: 10px;
        }

        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100000;
        }

        .help-modal.active {
            display: flex;
        }

        .help-modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 8px;
            position: relative;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--favicon-background);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .help-modal .close-modal {
            position: absolute;
            right: 10px;
            top: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .help-modal-content #help-content {
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
        }

        .help-modal-content #help-content p {
            margin: 15px 0;
            line-height: 1.6;
        }

        .help-modal-content #help-content a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        .help-modal-content #help-content a:hover {
            color: var(--hover-color);
        }

        modal-text {
            font-family: 'JetBrains Mono', monospace;
            color: var(--title-color);
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(247, 147, 26, 0.5);

        }

        .modal-text {
            color: var(--text-secondary) !important;
        }

        .help-modal-content {
            background-color: var(--card-bg) !important;
            color: var(--text-secondary) !important;
        }

        .help-modal-content a {
            color: var(--link-color) !important;
            text-decoration: none;
            transition: color 0.2s;
        }

        .help-modal-content a:hover {
            color: var(--hover-color) !important;
        }

        
        .opml-buttons {
            display: flex;
            gap: 10px;
            padding: 0;
            
        }

        .opml-button {
            background-color: rgba(200, 200, 200, 0.15);
            border: 1px solid var(--favicon-background);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            transition: all 0.2s ease;
            margin: 0px;
            margin-top: 8px;
        }

        .opml-button:hover {
            color: var(--hover-color);
            background: var(--accent-glow);
            transform: translateY(-1px);
        }

        .opml-button svg {
            fill: var(--text-secondary);
        }

        .opml-button:hover svg {
            fill: var(--hover-color);
        }

        .source-dropdown-content .source-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .source-dropdown-content .source-option input[type="checkbox"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 16px !important;
            height: 16px !important;
            min-width: 16px !important;
            min-height: 16px !important;
            max-width: 16px !important;
            max-height: 16px !important;
            border: 1px solid var(--favicon-background);
            border-radius: 4px;
            background: var(--card-bg);
            margin: 0;
            padding: 0;
            cursor: pointer;
            position: relative;
            flex: 0 0 16px;
            box-sizing: border-box;
            display: inline-block;
        }

    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "THE ORANGE SIGNAL",
      "description": "Stay updated with the latest Bitcoin news and podcasts with THE ORANGE SIGNAL.",
      "url": "https://theorangesignal.btcdir.org",
      "publisher": {
        "@type": "Organization",
        "name": "BXL909",
        "url": "https://bxl909.github.io"
      }
    }
    </script>
</head>
<body>
    <img src="BitcoinBig.png" alt="Bitcoin Logo" class="background-bitcoin">
    <div class="compact-toggle">
        <span class="toggle-label">Compact</span>
        <label class="toggle-switch">
            <input type="checkbox" id="compactToggle">
            <span class="toggle-slider"></span>
        </label>
    </div>
    <div class="theme-toggle">
        <span class="toggle-label">Light</span>
        <label class="toggle-switch">
            <input type="checkbox" id="themeToggle">
            <span class="toggle-slider"></span>
        </label>
    </div>
    <div class="layout-toggle">
        <span class="toggle-label">Grid</span>
        <label class="toggle-switch">
            <input type="checkbox" id="layoutToggle">
            <span class="toggle-slider"></span>
        </label>
    </div>
    <div class="banner-container">
        <div class="banner-content">
            <div class="title-container">
                <div class="logo">
                    <img src="bitcoin.png" alt="Bitcoin Logo" style="width: 100%; height: 100%; filter: drop-shadow(0 0 8px var(--accent-glow));">
                </div>
                <a href="#">
                    <img src="OrangeSignal.png" alt="THE ORANGE SIGNAL" style="width: auto; height: 50px;">
                </a>
                
            </div>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search articles... /">
                <div class="button-group">
                    <select id="sourceFilter"></select>
                    
                    <button id="bookmarksToggle" class="share-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24">
                            <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
                        </svg>
                        Show Bookmarks
                    </button>
                </div>

            </div>
        </div>
    </div>

    <div class="bitcoin-stats">
        <div class="stat-item">
            <div class="stat-label">BTC / USD</div>
            <div class="stat-value" id="btc-price">Loading...</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Block Height</div>
            <div class="stat-value" id="block-height">Loading...</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Network Hashrate</div>
            <div class="stat-value" id="hashrate">Loading...</div>
        </div>
    </div>

    <div id="loading">Loading feeds...</div>
    <div id="articles"></div>
    <button id="loadMoreBtn" class="load-more-btn" style="display: none;">Load More</button>

    <div class="article-modal">
        <div class="article-frame-container">
            <button class="close-modal">Ã—</button>
            <iframe class="article-frame" title="Article Content"></iframe>
        </div>
    </div>

    <div id="sentinel" style="height: 10px;"></div>

    <script src="https://unpkg.com/rss-parser/dist/rss-parser.min.js"></script>
    <script>
        const feeds = [
            'https://nobsbitcoin.com/rss/',
            'https://cointelegraph.com/rss/tag/bitcoin',
            'https://bitcoinmagazine.com/.rss/full/',
            'https://btctimes.com/rss/',
            'https://dailyhodl.com/bitcoin-news/feed/',
            'https://loveisbitcoin.com/feed/',
            'https://thebitcoinmanual.com/articles/feed/',
            'https://bitcoincore.org/en/announcements.xml',
            'https://stacker.news/~bitcoin/rss',
            'https://www.ft.com/bitcoin?format=rss',
            'https://feeds.bbci.co.uk/news/topics/c734j90em14t/rss.xml',
            'https://feeds.castos.com/mj96z',
            'https://anchor.fm/s/91b8fbc8/podcast/rss',
            'https://anchor.fm/s/7d083a4/podcast/rss',
            'https://anchor.fm/s/e29097f4/podcast/rss',
            'https://anchor.fm/s/9500fad8/podcast/rss',
            'https://feeds.libsyn.com/219386/rss',
            'https://serve.podhome.fm/rss/c90e609a-df1e-596a-bd5e-57bcc8aad6cc'
        ];

        const sourceInfo = {
            'nobsbitcoin.com': {
                logo: 'https://nobsbitcoin.com/favicon.ico',
                name: 'NoBS Bitcoin',
                feedUrl: 'https://nobsbitcoin.com/rss/'
            },
            'bitcoinmagazine.com': {
                logo: 'https://bitcoinmagazine.com/favicon.ico',
                name: 'Bitcoin Magazine',
                feedUrl: 'https://bitcoinmagazine.com/.rss/full/'
            },
            'bitcoincore.org': {
                logo: 'https://bitcoincore.org/assets/images/favicon.png',
                name: 'Bitcoin Core',
                feedUrl: 'https://bitcoincore.org/en/announcements.xml'
            },
            'btctimes.com': {
                logo: 'https://btctimes.com/favicon.ico',
                name: 'BTC Times',
                feedUrl: 'https://btctimes.com/rss/'
            },                
            'thebitcoinmanual.com': {
                logo: 'https://thebitcoinmanual.com/wp-content/uploads/2021/03/Main-Logo-Mockup-1-1024x655.jpg',
                name: 'The Bitcoin Manual',
                feedUrl: 'https://thebitcoinmanual.com/articles/feed/'
            },    
            'stacker.news': {
                logo: 'https://stacker.news/favicon.ico',
                name: 'Stacker News',
                feedUrl: 'https://stacker.news/~bitcoin/rss'
            },
            'loveisbitcoin.com': {
                logo: 'https://loveisbitcoin.com/wp-content/uploads/2021/05/cropped-love-is-bitcoin-logo-sq-1-192x192.png',
                name: 'Love Is Bitcoin',
                feedUrl: 'https://loveisbitcoin.com/feed/'
            },    
            'ft.com': {
                logo: 'https://www.ft.com/favicon.ico',
                name: 'Financial Times',
                feedUrl: 'https://www.ft.com/bitcoin?format=rss'
            },
            'bbc.co.uk': {
                logo: 'https://www.bbc.co.uk/favicon.ico',
                name: 'BBC News',
                feedUrl: 'https://feeds.bbci.co.uk/news/topics/c734j90em14t/rss.xml'
            },

            'bitcoin.review': {
                logo: 'https://podcasters.spotify.com/favicon.ico',
                name: 'Bitcoin.review',
                feedUrl: 'https://anchor.fm/s/9500fad8/podcast/rss'
            },

            'sites.libsyn.com': {
                logo: 'https://podcasters.spotify.com/favicon.ico',
                name: 'What Bitcoin Did',
                feedUrl: 'https://feeds.libsyn.com/219386/rss'
            },
            'bitcoin-audible.castos.com': {
                logo: 'https://podcasters.spotify.com/favicon.ico',
                name: 'Bitcoin Audible',
                feedUrl: 'https://feeds.castos.com/mj96z'
            },
            'rabbit hole recap': {
                logo: 'https://podcasters.spotify.com/favicon.ico',
                name: 'Rabbit Hole Recap',
                feedUrl: 'https://anchor.fm/s/91b8fbc8/podcast/rss'
            },
            'stephan livera': {
                logo: 'https://podcasters.spotify.com/favicon.ico',
                name: 'Stephan Livera Podcast',
                feedUrl: 'https://anchor.fm/s/7d083a4/podcast/rss'
            },
            'Money matters': {
                logo: 'https://podcasters.spotify.com/favicon.ico',
                name: 'Money Matters',
                feedUrl: 'https://anchor.fm/s/e29097f4/podcast/rss'
            },
            'serve.podhome.fm': {
                logo: 'https://podcasters.spotify.com/favicon.ico',
                name: 'Citadel Dispactch',
                feedUrl: 'https://serve.podhome.fm/rss/c90e609a-df1e-596a-bd5e-57bcc8aad6cc'
            },
            'cointelegraph.com': {
                logo: 'https://cointelegraph.com/favicon.ico',
                name: 'Cointelegraph',
                feedUrl: 'https://cointelegraph.com/rss/tag/bitcoin'
            },            
            'dailyhodl.com': {
                logo: 'https://dailyhodl.com/favicon.ico',
                name: 'Daily Hodl',
                feedUrl: 'https://dailyhodl.com/bitcoin-news/feed/'
            }
        };

        function getDomainFromUrl(url) {
            try {
                return new URL(url).hostname;
            } catch {
                return null;
            }
        }

        function getSourceInfo(article) {
            const sourceName = article.source || article.author || 'Unknown Source';
            const sourceData = sourceInfo[sourceName] || {
                logo: `data:image/svg+xml,${encodeURIComponent(`
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                        <circle cx="8" cy="8" r="8" fill="#f7931a"/>
                        <text x="8" y="8" text-anchor="middle" dy=".3em" fill="white" 
                              font-family="Arial" font-size="10" font-weight="bold">
                            ${sourceName.charAt(0).toUpperCase()}
                        </text>
                    </svg>
                `)}`,
                name: sourceName
            };
            return sourceData;
        }

        async function fetchFeed(feedUrl) {
            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`;
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                if (data.items) {
                    return data.items;
                }
            } catch (error) {
                console.error(`Error fetching ${feedUrl} with rss2json:`, error);
            }

            try {
                const parser = new RSSParser();
                const feed = await parser.parseURL(feedUrl);
                return feed.items.map(item => ({
                    title: item.title,
                    link: item.link,
                    description: item.contentSnippet || item.content || item.summary,
                    pubDate: item.pubDate,
                    enclosure: item.enclosure,
                    thumbnail: item.itunes ? item.itunes.image : null,
                    media: item.media || {}
                }));
            } catch (error) {
                console.error(`Error parsing ${feedUrl} with rss-parser:`, error);
                return [];
            }
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function estimateReadingTime(text) {
            const wordsPerMinute = 200;
            const words = text.trim().split(/\s+/).length;
            const minutes = Math.ceil(words / wordsPerMinute);
            return minutes;
        }

        function extractFirstImage(description) {
            const div = document.createElement('div');
            div.innerHTML = description;
            const img = div.querySelector('img');
            if (img) {
                img.remove();
                return {
                    imgSrc: img.src,
                    cleanDescription: div.innerHTML.trim()
                };
            }
            return {
                imgSrc: null,
                cleanDescription: description.trim()
            };
        }

        function getArticleImage(article) {
            if (article.enclosure && article.enclosure.type && article.enclosure.type.startsWith('image/')) {
                return article.enclosure.link;
            }

            if (article.thumbnail) {
                return article.thumbnail;
            }

            if (article.media && article.media.content) {
                return article.media.content.url;
            }

            const div = document.createElement('div');
            div.innerHTML = article.description || '';
            const img = div.querySelector('img');
            if (img && img.src) {
                return img.src;
            }

            if (article.content) {
                div.innerHTML = article.content;
                const contentImg = div.querySelector('img');
                if (contentImg && contentImg.src) {
                    return contentImg.src;
                }
            }

           return 'Bitcoin.png';
        }

        let currentPage = 1;
        const articlesPerPage = 10;
        let allLoadedArticles = [];

        let customFeeds = JSON.parse(localStorage.getItem('customFeeds') || '{}');

        const getActiveFeeds = () => {
            return [...feeds, ...Object.values(customFeeds).map(feed => feed.url)];
        };

        async function loadAllFeeds() {
            const loadingDiv = document.getElementById('loading');
            const articlesDiv = document.getElementById('articles');
            const sentinel = document.getElementById('sentinel');
            const isBookmarksView = document.getElementById('bookmarksToggle').classList.contains('active');
            
            try {
                const bookmarksToggle = document.getElementById('bookmarksToggle');
                const isBookmarksView = bookmarksToggle?.classList.contains('active');

                if (isBookmarksView) {
                    const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
                    
                    if (bookmarks.length === 0) {
                        articlesDiv.innerHTML = `
                            <div class="article">
                                No bookmarked articles found. Click the bookmark button on any article to save it here.
                            </div>`;
                        loadingDiv.style.display = 'none';
                        return;
                    }
                }

                if (currentPage === 1 && !isBookmarksView) {
                    const allArticles = await Promise.all(getActiveFeeds().map(async feed => {
                        try {
                            const articles = await fetchFeed(feed);
                            return articles.map(article => ({
                                ...article,
                                feedUrl: feed 
                            }));
                        } catch (error) {
                            console.error(`Error fetching feed ${feed}:`, error);
                            return [];
                        }
                    }));
                    
                    allLoadedArticles = allArticles
                        .flat()
                        .sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
                    
                }

                const checkboxes = document.querySelectorAll('.source-option input[type="checkbox"]:checked');
                const selectedSources = Array.from(checkboxes)
                    .filter(cb => cb.id !== 'select-all')
                    .map(cb => cb.value);
                

                let filteredArticles = allLoadedArticles;
                
                if (isBookmarksView) {
                    const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
                    filteredArticles = allLoadedArticles.filter(article => 
                        bookmarks.some(bookmark => bookmark.link === article.link)
                    );
                } else {
                    filteredArticles = allLoadedArticles.filter(article => {
                        const domain = getDomainFromUrl(article.link);
                        const feedUrl = article.feedUrl;

                        const customFeedMatch = Object.entries(customFeeds).find(([name, feed]) => {
                            return feed.url === feedUrl;
                        });

                        const standardSourceMatch = Object.values(sourceInfo).find(source => source.feedUrl === feedUrl);

                        return (customFeedMatch && selectedSources.includes(customFeedMatch[0])) ||
                               (standardSourceMatch && selectedSources.includes(standardSourceMatch.name)) ||
                               (domain && selectedSources.includes(domain));
                    });
                }


                const startIndex = (currentPage - 1) * articlesPerPage;
                const endIndex = startIndex + articlesPerPage;
                const currentArticles = filteredArticles.slice(startIndex, endIndex);

                if (currentArticles.length === 0) {
                    if (sentinel) sentinel.style.display = 'none';
                    if (currentPage === 1) {
                        articlesDiv.innerHTML = `
                            <div class="article">
                                No articles found${selectedSources.length > 0 ? ' for the selected sources' : ''}.
                            </div>`;
                    }
                    return;
                }

                const articlesHTML = currentArticles
                    .map(article => {
                        const imgSrc = getArticleImage(article);
                        let description = article.description || '';
                        description = description.replace(/<img[^>]*>/g, '').trim();
                        const authorData = getSourceInfo(article);

                        const domain = getDomainFromUrl(article.link);
                        const websiteSource = domain ? (sourceInfo[domain] || {
                            logo: `https://${domain}/favicon.ico`,
                            name: domain
                        }) : null;

                        return `
                            <div class="article">
                                <h2>
                                    ${websiteSource ? `
                                        <img class="source-logo" 
                                             src="${websiteSource.logo}" 
                                             alt="${websiteSource.name}"
                                             onerror="this.onerror=null; this.src='data:image/svg+xml,${encodeURIComponent(`
                                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                                     <circle cx="8" cy="8" r="8" fill="#f7931a"/>
                                                     <text x="8" y="8" text-anchor="middle" dy=".3em" fill="white" 
                                                           font-family="Arial" font-size="10" font-weight="bold">
                                                         ${websiteSource.name.charAt(0).toUpperCase()}
                                                     </text>
                                                 </svg>
                                             `)}'"
                                        />
                                    ` : ''}
                                    <a href="${article.link}" class="article-link" data-url="${article.link}" data-feed-url="${article.feedUrl}">
                                        ${decodeHTMLEntities(article.title)}
                                    </a>
                                </h2>
                                <button class="expand-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M7 7l5 5 5-5"/>
                                    </svg>
                                    Expand
                                </button>
                                <div class="article-meta">
                                    <div class="article-meta-left">
                                        ${websiteSource ? `
                                            <span class="article-source website-source" 
                                                  onclick="window.open('https://${domain}', '_blank')" 
                                                  style="cursor: pointer;" 
                                                  title="Visit ${websiteSource.name}">
                                                <img class="source-logo" 
                                                     src="${websiteSource.logo}" 
                                                     alt="${websiteSource.name}"
                                                     onerror="this.onerror=null; this.src='data:image/svg+xml,${encodeURIComponent(`
                                                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                                             <circle cx="8" cy="8" r="8" fill="#f7931a"/>
                                                             <text x="8" y="8" text-anchor="middle" dy=".3em" fill="white" 
                                                                   font-family="Arial" font-size="10" font-weight="bold">
                                                                 ${websiteSource.name.charAt(0).toUpperCase()}
                                                             </text>
                                                         </svg>
                                                     `)}'"
                                                />
                                                ${websiteSource.name}
                                            </span>
                                        ` : ''}
                                        ${authorData ? `
                                            <span class="article-source" 
                                                  title="${authorData.name}">
                                                <img class="source-logo" 
                                                     src="${authorData.logo}" 
                                                     alt="${authorData.name}"
                                                     onerror="this.onerror=null; this.src='data:image/svg+xml,${encodeURIComponent(`
                                                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                                             <circle cx="8" cy="8" r="8" fill="#f7931a"/>
                                                             <text x="8" y="8" text-anchor="middle" dy=".3em" fill="white" 
                                                                   font-family="Arial" font-size="10" font-weight="bold">
                                                                 ${authorData.name.replace('Cointelegraph by ', '').charAt(0).toUpperCase()}
                                                             </text>
                                                         </svg>
                                                     `)}'"
                                                />
                                                ${authorData.name.replace('Cointelegraph by ', '')}
                                            </span>
                                        ` : ''}
                                        <span class="article-date">${formatDate(article.pubDate)}</span>
                                    </div>
                                    <div class="article-meta-right">
                                        <span class="reading-time">${estimateReadingTime(description)} min read</span>
                                        <button class="share-btn bookmark-btn">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24">
                                                <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
                                            </svg>
                                            <span class="label">Bookmark</span>
                                        </button>
                                        <button class="share-btn" onclick="share('${encodeURIComponent(article.link)}', '${encodeURIComponent(article.title)}')">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24">
                                                <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92zM18 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM6 13c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 7.02c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
                                            </svg>
                                            <span class="label">Share</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="article-description">
                                    <img src="${imgSrc}" alt="${article.title}" 
                                         onerror="this.onerror=null; this.src='https://bitcoin.org/img/icons/opengraph.png'"/>
                                    ${description}
                                </div>
                            </div>
                        `;
                    })
                    .join('');

                if (currentPage === 1) {
                    articlesDiv.innerHTML = articlesHTML;
                } else {
                    if (sentinel) sentinel.remove();
                    articlesDiv.insertAdjacentHTML('beforeend', articlesHTML);
                }

                if (endIndex < allLoadedArticles.length) {
                    const sentinel = document.createElement('div');
                    sentinel.id = 'sentinel';
                    sentinel.style.height = '10px';
                    articlesDiv.appendChild(sentinel);
                    setupInfiniteScroll(); 
                }

                loadingDiv.style.display = 'none';

            } catch (error) {
                console.error('Error:', error);
                loadingDiv.innerHTML = 'Error loading feeds. Please try again later.';
            }
        }

        let disableFetching = false; 

        function setupInfiniteScroll() {
            if (window.existingObserver) {
                window.existingObserver.disconnect();
            }

            const sentinel = document.getElementById('sentinel');
            if (!sentinel) return;

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const bookmarksToggle = document.getElementById('bookmarksToggle');
                        if (!bookmarksToggle?.classList.contains('active') && !disableFetching) { 
                            currentPage++;
                            loadAllFeeds();
                        }
                    }
                });
            }, {
                root: null,
                rootMargin: '200px',
                threshold: 0.1
            });

            observer.observe(sentinel);
            window.existingObserver = observer;
        }

        loadAllFeeds();

        function share(url, title) {
            const encodedUrl = encodeURIComponent(url);
            const encodedTitle = encodeURIComponent(title);
            
            if (navigator.share) {
                try {
                    navigator.share({
                        title: title, 
                        url: url      
                    }).catch(err => {
                        console.error('Share failed:', err);
                        navigator.clipboard.writeText(url);
                        alert('Link copied to clipboard!');
                    });
                } catch (err) {
                    console.error('Share failed:', err);
                    navigator.clipboard.writeText(url);
                    alert('Link copied to clipboard!');
                }
            } else {
                navigator.clipboard.writeText(url);
                alert('Link copied to clipboard!');
            }
        }

        const layoutToggle = document.getElementById('layoutToggle');
        const articlesContainer = document.getElementById('articles');
        
        const savedGridLayout = localStorage.getItem('gridLayout');
        if (savedGridLayout === null) {
            const isMobile = window.matchMedia("(max-width: 768px)").matches;
            layoutToggle.checked = isMobile;
        } else {
            layoutToggle.checked = savedGridLayout === 'true';
        }

        updateLayout();

        layoutToggle.addEventListener('change', () => {
            localStorage.setItem('gridLayout', layoutToggle.checked);
            updateLayout();
        });

        function updateLayout() {
            if (layoutToggle.checked) {
                articlesContainer.classList.add('grid-layout');
            } else {
                articlesContainer.classList.remove('grid-layout');
            }
        }

        const themeToggle = document.getElementById('themeToggle');
        
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        themeToggle.checked = savedTheme === 'light';

        themeToggle.addEventListener('change', () => {
            const newTheme = themeToggle.checked ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        function addKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.key === '/' && !e.target.matches('input, textarea')) {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                
                if (e.key === 'g' && !e.target.matches('input, textarea')) {
                    document.getElementById('layoutToggle').click();
                }
                
                if (e.key === 't' && !e.target.matches('input, textarea')) {
                    document.getElementById('themeToggle').click();
                }

                if (e.key === 'b' && !e.target.matches('input, textarea')) {
                    document.getElementById('bookmarksToggle').click();
                }
            });
        }

        function addBookmarking() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            
            function updateBookmarkStates() {
                document.querySelectorAll('.article').forEach(article => {
                    const linkElement = article.querySelector('h2 a');
                    const bookmarkBtn = article.querySelector('.bookmark-btn');
                    if (linkElement && bookmarkBtn) {
                        const link = linkElement.href;
                        bookmarkBtn.classList.toggle('active', bookmarks.some(b => b.link === link));
                    }
                });
            }
            
            document.addEventListener('click', e => {
                const bookmarkBtn = e.target.closest('.bookmark-btn');
                if (bookmarkBtn) {
                    const article = bookmarkBtn.closest('.article');
                    const link = article.querySelector('h2 a').href;
                    const title = article.querySelector('h2 a').textContent;
                    
                    const bookmarkIndex = bookmarks.findIndex(b => b.link === link);
                    if (bookmarkIndex === -1) {
                        bookmarks.push({ link, title });
                        bookmarkBtn.classList.add('active');
                    } else {
                        bookmarks.splice(bookmarkIndex, 1);
                        bookmarkBtn.classList.remove('active');
                    }
                    
                    localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
                }
            });

            const observer = new MutationObserver(() => {
                updateBookmarkStates();
            });
            
            observer.observe(document.getElementById('articles'), { childList: true, subtree: true });
            
            updateBookmarkStates();
        }

        function populateSourceFilter() {
            const sourceFilter = document.getElementById('sourceFilter');
            const sourceFilterContainer = sourceFilter.parentElement;
            
            const existingDropdown = sourceFilterContainer.querySelector('.source-dropdown');
            const existingRefreshBtn = sourceFilterContainer.querySelector('#refreshBtn');
            if (existingDropdown) existingDropdown.remove();
            if (existingRefreshBtn) existingRefreshBtn.remove();
            
            const dropdown = document.createElement('div');
            dropdown.className = 'source-dropdown';
            
            const dropdownBtn = document.createElement('button');
            dropdownBtn.className = 'source-dropdown-btn';
            dropdownBtn.innerHTML = `
                Sources
                <span class="selected-count">${Object.keys(sourceInfo).length}</span>
            `;

            const refreshBtn = document.createElement('button');
            refreshBtn.id = 'refreshBtn';
            refreshBtn.className = 'share-btn';
            refreshBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6M1 20v-6h6"/>
                    <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                </svg>
                <span class="label">Refresh</span>
            `;

            sourceFilterContainer.appendChild(dropdown);
            sourceFilterContainer.appendChild(refreshBtn);

            setupRefreshButton();

            const dropdownContent = document.createElement('div');
            dropdownContent.className = 'source-dropdown-content';
            
            const customFeedsSection = document.createElement('div');
            customFeedsSection.className = 'custom-feeds-section';
            
            const addFeedButton = document.createElement('button');
            addFeedButton.className = 'add-feed-button';
            addFeedButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="16"/>
                    <line x1="8" y1="12" x2="16" y2="12"/>
                </svg>
                <span class="label">Add Custom RSS Feed</span>
            `;
            
            const feedForm = document.createElement('div');
            feedForm.className = 'custom-feed-form';
            feedForm.innerHTML = `
                <input type="text" placeholder="Feed Name" id="feedName">
                <input type="url" placeholder="Feed URL" id="feedUrl">
                <button type="button" id="saveFeed">Add Feed</button>
                <button type="button" id="cancelFeed">Cancel</button>
            `;

            const savedSelections = JSON.parse(localStorage.getItem('sourceSelections') || '{}');
            const hasStoredSelections = Object.keys(savedSelections).length > 0;
            
            const selectAllOption = document.createElement('div');
            selectAllOption.className = 'source-option';
            selectAllOption.innerHTML = `
                <input type="checkbox" id="select-all" ${!hasStoredSelections || savedSelections['select-all'] ? 'checked' : ''}>
                <label for="select-all">Select All</label>
            `;
            
            const divider = document.createElement('div');
            divider.className = 'source-divider';

            customFeedsSection.appendChild(addFeedButton);
            customFeedsSection.appendChild(feedForm);
            
            const opmlButtons = document.createElement('div');
            opmlButtons.className = 'opml-buttons';
            opmlButtons.innerHTML = `
                <button class="opml-button" id="exportOpml">
                    <span class="label">Export OPML</span>
                </button>
                <button class="opml-button" id="importOpml">
                    <span class="label">Import OPML</span>
                </button>
                <input type="file" id="opmlFileInput" accept=".opml,.xml" style="display: none;">
            `;
            customFeedsSection.appendChild(opmlButtons);

            const exportOpmlBtn = opmlButtons.querySelector('#exportOpml');
            const importOpmlBtn = opmlButtons.querySelector('#importOpml');
            const opmlFileInput = opmlButtons.querySelector('#opmlFileInput');

            exportOpmlBtn.addEventListener('click', () => {
                const opmlContent = `<?xml version="1.0" encoding="UTF-8"?>
                <opml version="1.0">
                    <head>
                        <title>THE ORANGE SIGNAL RSS FEEDS</title>
                    </head>
                    <body>
                        ${Object.values(sourceInfo).map(source => 
                            `<outline text="${source.name}" title="${source.name}" type="rss" xmlUrl="${feeds[Object.values(sourceInfo).indexOf(source)]}"/>`
                        ).join('\n                        ')}
                        ${Object.entries(customFeeds).map(([name, feed]) =>
                            `<outline text="${name}" title="${name}" type="rss" xmlUrl="${feed.url}"/>`
                        ).join('\n                        ')}
                    </body>
                </opml>`;

                const blob = new Blob([opmlContent], { type: 'text/xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'bitcoin-broadcast-feeds.opml';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });

            importOpmlBtn.addEventListener('click', () => {
                opmlFileInput.click();
            });

            opmlFileInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        const text = await file.text();
                        const parser = new DOMParser();
                        const opml = parser.parseFromString(text, 'text/xml');
                        const outlines = opml.querySelectorAll('outline[type="rss"]');
                        
                        outlines.forEach(outline => {
                            const feedName = outline.getAttribute('text') || outline.getAttribute('title');
                            const feedUrl = outline.getAttribute('xmlUrl');
                            
                            if (feedName && feedUrl) {
                                if (!Object.values(sourceInfo).some(s => s.name === feedName)) {
                                    customFeeds[feedName] = {
                                        name: feedName,
                                        url: feedUrl,
                                        favicon: feedUrl.startsWith('http') 
                                            ? `${new URL(feedUrl).origin}/favicon.ico` 
                                            : `${new URL(feedUrl).origin}/favicon.ico` 
                                    };
                                }
                            }
                        });
                        
                        localStorage.setItem('customFeeds', JSON.stringify(customFeeds));
                        populateSourceFilter();
                        currentPage = 1;
                        loadAllFeeds();
                        
                    } catch (error) {
                        console.error('Error parsing OPML file:', error);
                        alert('Error importing OPML file. Please make sure it\'s a valid OPML file.');
                    }
                }
            });

            dropdownContent.appendChild(customFeedsSection);
            dropdownContent.appendChild(document.createElement('div')).className = 'source-divider';
            dropdownContent.appendChild(selectAllOption);
            dropdownContent.appendChild(divider);

            Object.values(sourceInfo).forEach(source => {
                const option = createSourceOption(source, savedSelections);
                dropdownContent.appendChild(option);
            });

            Object.entries(customFeeds).forEach(([name, feed]) => {
                const option = createSourceOption(feed, savedSelections, true);
                dropdownContent.appendChild(option);
            });

            dropdown.appendChild(dropdownBtn);
            dropdown.appendChild(dropdownContent);

            dropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdown.classList.toggle('active');
            });
            
            document.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('active');
                }
            });

            function saveSelections() {
                const selections = {
                    'select-all': selectAllCheckbox.checked
                };
                
                checkboxes.forEach(cb => {
                    if (cb.id !== 'select-all') {
                        selections[cb.id] = cb.checked;
                    }
                });
                
                localStorage.setItem('sourceSelections', JSON.stringify(selections));
            }

            const checkboxes = dropdownContent.querySelectorAll('input[type="checkbox"]');
            const selectAllCheckbox = dropdownContent.querySelector('#select-all');
            
            function updateSelectedCount() {
                const selectedCount = Array.from(checkboxes)
                    .filter(cb => cb.id !== 'select-all' && cb.checked).length;
                dropdownBtn.querySelector('.selected-count').textContent = selectedCount;
            }
            
            selectAllCheckbox.addEventListener('change', () => {
                checkboxes.forEach(cb => {
                    if (cb.id !== 'select-all') {
                        cb.checked = selectAllCheckbox.checked;
                    }
                });
                updateSelectedCount();
                saveSelections();
                currentPage = 1;
                loadAllFeeds();
            });
            
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    if (checkbox.id !== 'select-all') {
                        const allChecked = Array.from(checkboxes)
                            .filter(cb => cb.id !== 'select-all')
                            .every(cb => cb.checked);
                        selectAllCheckbox.checked = allChecked;
                        updateSelectedCount();
                        saveSelections();
                        currentPage = 1;
                        loadAllFeeds();
                    }
                });
            });

            updateSelectedCount();

            addFeedButton.addEventListener('click', () => {
                feedForm.classList.toggle('active');
            });

            feedForm.querySelector('#saveFeed').addEventListener('click', () => {
                const feedName = feedForm.querySelector('#feedName').value.trim();
                const feedUrl = feedForm.querySelector('#feedUrl').value.trim();
                
                if (feedName && feedUrl) {
                    let faviconUrl;
                    try {
                        const urlObj = new URL(feedUrl);
                        faviconUrl = `${urlObj.origin}/favicon.ico`;
                        
                        customFeeds[feedName] = {
                            name: feedName,
                            url: feedUrl,
                            favicon: faviconUrl
                        };
                        
                        localStorage.setItem('customFeeds', JSON.stringify(customFeeds));
                        feedForm.querySelector('#feedName').value = '';
                        feedForm.querySelector('#feedUrl').value = '';
                        feedForm.classList.remove('active');
                        
                        const wasActive = document.querySelector('.source-dropdown').classList.contains('active');
                        const sourceFilterContainer = document.querySelector('.source-dropdown');
                        if (sourceFilterContainer) {
                            sourceFilterContainer.remove();
                        }
                        populateSourceFilter();
                        
                        if (wasActive) {
                            document.querySelector('.source-dropdown').classList.add('active');
                        }
                        
                        currentPage = 1;
                        loadAllFeeds();
                    } catch (error) {
                        console.error('Error parsing URL:', error);
                    }
                }
            });

            feedForm.querySelector('#cancelFeed').addEventListener('click', () => {
                feedForm.classList.remove('active');
                feedForm.querySelector('#feedName').value = '';
                feedForm.querySelector('#feedUrl').value = '';
            });

            dropdownContent.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-feed')) {
                    const feedName = e.target.dataset.feed;
                    delete customFeeds[feedName];
                    localStorage.setItem('customFeeds', JSON.stringify(customFeeds));
                    
                    const wasActive = document.querySelector('.source-dropdown').classList.contains('active');
                    
                    const sourceFilterContainer = document.querySelector('.source-dropdown');
                    if (sourceFilterContainer) {
                        sourceFilterContainer.remove();
                    }
                    populateSourceFilter(); 
                    
                    if (wasActive) {
                        document.querySelector('.source-dropdown').classList.add('active');
                    }
                    
                    currentPage = 1;
                    loadAllFeeds();
                }
            });
        }

        function createSourceOption(source, savedSelections, isCustom = false) {
            const option = document.createElement('div');
            option.className = 'source-option';
            const isChecked = !Object.keys(savedSelections).length || savedSelections[`source-${source.name}`] !== false;
            
            const fallbackFavicon = `data:image/svg+xml,${encodeURIComponent(`
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                    <circle cx="8" cy="8" r="8" fill="#f7931a"/>
                    <text x="8" y="8" text-anchor="middle" dy=".3em" fill="white" 
                          font-family="Arial" font-size="10" font-weight="bold">
                        ${source.name.charAt(0).toUpperCase()}
                    </text>
                </svg>
            `)}`;

            let faviconUrl = source.favicon;
            if (!faviconUrl && source.url) {
                try {
                    const urlObj = new URL(source.url);
                    faviconUrl = `${urlObj.origin}/favicon.ico`;
                } catch (error) {
                    console.error('Error parsing URL for favicon:', error);
                    faviconUrl = fallbackFavicon;
                }
            }

            option.innerHTML = `
                <input type="checkbox" id="source-${source.name}" value="${source.name}" ${isChecked ? 'checked' : ''}>
                <label for="source-${source.name}">
                    ${source.name} ${isCustom ? '<span class="custom-feed-label">(Custom)</span>' : ''}
                </label>
                ${isCustom ? `<button class="remove-feed" data-feed="${source.name}">Ã—</button>` : ''}
            `;
            return option;
        }

        function setupSourceFilter() {
            const sourceFilter = document.getElementById('sourceFilter');
            sourceFilter.addEventListener('change', () => {
                currentPage = 1; 
                loadAllFeeds();
            });
        }

        function setupBookmarksToggle() {
            const bookmarksToggle = document.getElementById('bookmarksToggle');
            
            bookmarksToggle.addEventListener('click', () => {
                bookmarksToggle.classList.toggle('active');
                if (bookmarksToggle.classList.contains('active')) {
                    bookmarksToggle.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24">
                            <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
                        </svg>
                        <span class="label">Hide Bookmarks</span>
                    `;
                } else {
                    bookmarksToggle.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24">
                            <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
                        </svg>
                        <span class="label">Show Bookmarks</span>
                    `;
                }
                currentPage = 1;
                loadAllFeeds();
            });
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');

            searchInput.addEventListener('input', () => {
                const searchTerm = searchInput.value.toLowerCase();
                const articles = document.querySelectorAll('.article');

                disableFetching = searchTerm.length > 0; // Disable fetching if search box is not empty

                articles.forEach(article => {
                    const title = article.querySelector('h2 a').textContent.toLowerCase();
                    const description = article.querySelector('.article-description').textContent.toLowerCase();

                    if (title.includes(searchTerm) || description.includes(searchTerm)) {
                        article.style.display = '';
                    } else {
                        article.style.display = 'none';
                    }
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateSourceFilter();
            setupSourceFilter();
            setupBookmarksToggle();
            addKeyboardShortcuts();
            addBookmarking();
            initializeModal();
            setupInfiniteScroll();
            updateCompactMode();
            setupSearch();
            setupRefreshButton();
        });

        function initializeModal() {
            const modal = document.querySelector('.article-modal');
            const iframe = modal.querySelector('.article-frame');
            const closeBtn = modal.querySelector('.close-modal');

            document.addEventListener('click', (e) => {
                const articleLink = e.target.closest('.article-link');
                if (articleLink) {
                    e.preventDefault();
                    const url = articleLink.getAttribute('data-url');
                    
                    const feedUrl = articleLink.getAttribute('data-feed-url');
                    const isCustomFeed = Object.values(customFeeds).some(feed => feed.url === feedUrl);
                    
                    if (url.includes('bitcoinmagazine.com') ||
                        url.includes('stacker.news') ||
                        isCustomFeed
                    ) {
                        window.open(url, '_blank');
                    } else {
                        window.open(url, '_blank');
                    }
                }
            });

            closeBtn.addEventListener('click', () => {
                modal.classList.remove('active');
                document.body.classList.remove('modal-open');
                iframe.src = 'about:blank'; 
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                    iframe.src = 'about:blank';
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    modal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                    iframe.src = 'about:blank';
                }
            });

            iframe.addEventListener('error', () => {
                const url = iframe.src;
                if (url && url !== 'about:blank') {
                    window.open(url, '_blank');
                    modal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                    iframe.src = 'about:blank';
                }
            });
        }

        function decodeHTMLEntities(text) {
            const textarea = document.createElement('textarea');
            textarea.innerHTML = text;
            return textarea.value;
        }

        const compactToggle = document.getElementById('compactToggle');
        
        compactToggle.checked = localStorage.getItem('compactMode') === 'true';
        updateCompactMode();

        compactToggle.addEventListener('change', () => {
            localStorage.setItem('compactMode', compactToggle.checked);
            updateCompactMode();
        });

        function updateCompactMode() {
            if (compactToggle.checked) {
                articlesContainer.classList.add('compact-mode');
            } else {
                articlesContainer.classList.remove('compact-mode');
                document.querySelectorAll('.article.expanded').forEach(article => {
                    article.classList.remove('expanded');
                });
            }
        }

        document.addEventListener('click', (e) => {
            const expandBtn = e.target.closest('.expand-btn');
            if (expandBtn) {
                const article = expandBtn.closest('.article');
                const isExpanded = article.classList.toggle('expanded');
                
                expandBtn.innerHTML = isExpanded ? `
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 17l-5-5-5 5"/>
                    </svg>
                    Collapse
                ` : `
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M7 7l5 5 5-5"/>
                    </svg>
                    Expand
                `;
            }
        });

        async function fetchBitcoinStats() {
            try {
                const priceResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                const priceData = await priceResponse.json();
                const price = priceData.bitcoin.usd.toLocaleString('en-US', {
                    style: 'currency',
                    currency: 'USD'
                });
                document.getElementById('btc-price').textContent = price;

                const blockchainResponse = await fetch('https://blockchain.info/q/getblockcount');
                const blockHeight = await blockchainResponse.text();
                document.getElementById('block-height').textContent = Number(blockHeight).toLocaleString();

                const hashrateResponse = await fetch('https://blockchain.info/q/hashrate');
                const hashrate = await hashrateResponse.text();
                const hashrateEH = (Number(hashrate) / 1000000).toFixed(2); // Convert to EH/s
                document.getElementById('hashrate').textContent = `${hashrateEH} EH/s`;

            } catch (error) {
                console.error('Error fetching Bitcoin stats:', error);
                document.getElementById('btc-price').textContent = 'Error loading';
                document.getElementById('block-height').textContent = 'Error loading';
                document.getElementById('hashrate').textContent = 'Error loading';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchBitcoinStats();
            setInterval(fetchBitcoinStats, 300000);
        });

        function setupRefreshButton() {
            const refreshBtn = document.getElementById('refreshBtn');
            
            refreshBtn.addEventListener('click', async () => {
                refreshBtn.disabled = true;
                refreshBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="spin">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                    <span class="label">Refresh</span>
                `;

                currentPage = 1;
                allLoadedArticles = [];
                
                const minimumAnimationTime = new Promise(resolve => setTimeout(resolve, 1000));
                
                await Promise.all([
                    loadAllFeeds(),
                    minimumAnimationTime
                ]);

                refreshBtn.disabled = false;
                refreshBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                    <span class="label">Refresh</span>
                `;
            });
        }

        function initializeHelpModal() {
            const helpButton = document.querySelector('.help-button');
            const helpModal = document.querySelector('.help-modal');
            const closeBtn = helpModal.querySelector('.close-modal');

            helpButton.addEventListener('click', () => {
                helpModal.classList.add('active');
                document.body.classList.add('modal-open');
            });

            closeBtn.addEventListener('click', () => {
                helpModal.classList.remove('active');
                document.body.classList.remove('modal-open');
            });

            helpModal.addEventListener('click', (e) => {
                if (e.target === helpModal) {
                    helpModal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && helpModal.classList.contains('active')) {
                    helpModal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeHelpModal();
        });
    </script>

    <button class="help-button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" style="fill: #f7931a;">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
        <span class="label">Do not press!</span>
    </button>

    <div class="help-modal">
        <div class="help-modal-content">
            <button class="close-modal">&times;</button>
            <div id="help-content">
                <a target="_blank" href="https://bxl909.github.io"><img src="BXL909.png" alt="BXL909" style="display: block; margin: 0 auto; max-width: 100%; height: auto; margin-bottom: 20px;"></a>
                <p class="modal-text" align="center">This is another free and open source Bitcoin project by BXL909. For more of my projects, or if you want to send a small tip in support of my work, visit</p>
                <p align="center"><a target="_blank" href="https://bxl909.github.io" style="color: var(--link-color); text-decoration: none;">https://bxl909.github.io</a></p>
                <p style="text-align: center;">ðŸ§¡</p>
            </div>
        </div>
    </div>
</body>
</html>
